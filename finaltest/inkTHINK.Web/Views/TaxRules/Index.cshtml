@model IEnumerable<inkTHINK.Domain.Entities.TaxRule>

@{
    ViewData["Title"] = "Reglas de Impuestos";
}

<h2>Reglas de Impuestos</h2>

<p>
    <a asp-action="Create" class="btn btn-primary">Crear Nueva Regla</a>
</p>

<table class="table table-striped">
    <thead>
        <tr>
            <th>Nombre</th>
            <th>Tipo</th>
            <th>Versi칩n</th>
            <th>Porcentaje</th>
            <th>Par치metros</th>
            <th>Vigente Desde</th>
            <th>Vigente Hasta</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
    @foreach (var item in Model)
    {
        <tr>
            <td>@item.Nombre</td>
            <td>@item.Tipo</td>
            <td>@item.Version</td>
            <td>@item.Porcentaje %</td>
            <td>
                @{
                    // Intentamos mostrar un resumen legible de ParamsJson
                    string parametros = string.Empty;
                    try
                    {
                        var dict = System.Text.Json.JsonSerializer.Deserialize<Dictionary<string, string>>(item.ParamsJson);
                        if (dict != null && dict.Count > 0)
                        {
                            parametros = string.Join(", ", dict.Take(3).Select(kv => $"{kv.Key}: {kv.Value}"));
                            if (dict.Count > 3)
                            {
                                parametros += ", ...";
                            }
                        }
                        else
                        {
                            parametros = "Sin par치metros";
                        }
                    }
                    catch
                    {
                        parametros = "JSON inv치lido";
                    }
                }
                @parametros
            </td>
            <td>@item.VigenteDesde.ToShortDateString()</td>
            <td>@(item.VigenteHasta?.ToShortDateString() ?? "Indefinido")</td>
            <td>
                <a asp-action="Edit" asp-route-id="@item.Id" class="btn btn-sm btn-warning">Editar</a> |
                <a asp-action="Details" asp-route-id="@item.Id" class="btn btn-sm btn-info">Detalles</a> |
                <a asp-action="Delete" asp-route-id="@item.Id" class="btn btn-sm btn-danger">Eliminar</a>
            </td>
        </tr>
    }
    </tbody>
</table>
